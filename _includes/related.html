{% assign posts = site.posts | where: "categories",page.lang %}

<div class="related">
    {% assign hasSimilar = '' %}
    {% for post in posts  %}
        {% assign postHasSimilar = false %}
        {% for tag in post.tags %}
            {% for thisTag in page.tags %}
                {% if postHasSimilar == false and hasSimilar.size < 5 and post != page and tag == thisTag %}
                    {% if hasSimilar.size == 0 %}
                    <h4>Related Posts</h4>
                    {% endif %}
                    {% include blog-post.html nocol = true%}
                    {% capture hasSimilar %}{{ hasSimilar }}*{% endcapture %}
                    {% assign postHasSimilar = true %}
                {% endif %}
            {% endfor %}
        {% endfor %}
    {% endfor %}
</div>
